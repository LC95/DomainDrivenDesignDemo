# DDD解码 - 有界上下文解释

## SapiensWorks.com作品, LC95自译

[DDD Decoded - Bounded Contexts Explained](http://blog.sapiensworks.com/post/2016/08/12/DDD-Bounded-Contexts-Explained)

在DDD中，我们将域组织成有界上下文（BC），至少有1个BC。 一个重要的模式，BC有点难以“学会”和解释，但我向你保证，你**需要**它来进行正确的DDD，从长远来看它简化了事情。

## **什么是有界上下文**

如果我告诉你，你已经使用了有限的上下文原理一段时间而不知道它怎么办？ 您知道那些UI，业务和数据库/持久层吗？ 这些是字面上有限的背景，是关注点分离原则的实现。 复杂的域可以被认为是一堆功能，但我们喜欢将它们分组为“专用”模块，其中每个模块都负责高级别的关注。

## **为什么需要有界上下文**

这不仅仅是模仿业务结构。这里的关键字是**有界**，也就是说，每个BC都有将模型与其他BC隔离开来的边界和限制(如果存在多个BC)。实际上，**边界是BC的主要好处**，因为它们“包含”特定的模型，允许我们关注它。我们可以说BC的主要用途是允许更好的解耦，这是可维护性的最重要特征。基本上，我们将相关的模型分组在一起，同时将它们与其他模型分离。

## **怎么定义一个有界上下文**

好吧，我们把注意放在语言上。 通用语言(Ubiquitous Language)不仅仅是DDD的流行语。 这意味着商业语言在特定上下文中具有相同的含义。 `Invoice`对`Accounting`有意义，但它可以只是程序员的类名。 仅仅因为名称相同并不意味着它是相同的概念。 客户对于营销人员以及付款方对于会计名称上是不同的，但他们对于生意来说概念是相同的

重要的是名称本身是无关紧要的。 我们需要理解在该上下文中有意义的概念定义，以便将业务案例放在某个BC中。 很多时候很容易，创建订单是电子商务的一部分，但发送订单的确认电子邮件显然是不同BC的一部分，比如营销或销售。 你如何发送电子邮件它是一个实现/基础设施细节，我们对此不感兴趣（对创建订单业务来说）。

## **BC之间如何交流**

由于BC的模型仅在BC内有意义，我们不能直接使用（参考）其他BC的模型。 但在许多情况下，我们需要另一个BC提供的信息。 如何在不突破界限的情况下获得它？

引入**域事件**。 它们代表了全局业务状态的变化，但它们确实具有另一个非常有用的技术特征：它们是消息，简单的数据结构。 它们不再是模型，它们只是信息而且它们不属于任一BC，它们在域范围内有效。

如果一个BC对来自另一个BC的数据感兴趣，它仅仅订阅相关事件，然后它将使用该数据来维护其自己的读取模型（是的，这是CQRS的实际操作）。 由于消息是数据而不是模型的一部分，因此不会违反边界。 所有这些都应该是BC自己基础设施的一部分。

但是，如何调用属于不同BC的业务案例呢？ 当您需要时，这意味着您正在处理业务流程，一系列业务案例，但是，即使业务案例属于BC，流程本身也不会，我们会使用流程管理器 (又称saga)负责处理业务流程，这是一个技术实现细节。 当我们定义流程时，我们关心哪些业务案例是其中的一部分，管理器本身并不作为域的一部分存在。

业务案例不应触发下一个业务案例，即不应当作为兼职的项目经理; 为了实现解耦和维护边界，业务案例对其他案例一无所知，了解和调用下一个案例是流程管理器的工作。

## **在特殊情况下**

你可能想把一个BC和另一个BC结合起来，因为这是最简单的方法。它**可以是**一个有效的，足够好的解决方案，但是你必须小心。这里的诀窍是在解耦和简单实现之间找到正确的折衷方案。

## **结论**

有界上下文概念对于应用程序的可维护性非常重要。 它允许我们处理不重叠的相关模型。 重要的是要注意这是一个逻辑分组标准，我们可以在整体内部实现所有内容。 但是如果应用程序需要可扩展并且我们使用分布式，那么我们可能希望每个应用程序/进程/服务器实现一个BC。